<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Hollow Knight</title>

    <link rel="icon" href="hk_logo.png">

    <!-- hk css -->
    <link rel="stylesheet" href="HKDesign.css">

    <!-- jquery ui css -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

    <!-- jquery ui -->
    <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
</head>

<body>
    <div id="universalblack"></div>
    <div id="background"></div>

    <div id="hktitle">
        <img src="HKTitle.png" id="title" alt="Hollow Knight Title">
        <h1 id="choose-title">Choose Character</h1>
        <select name="select-char" id="select-char" title="select-char">
            <optgroup label="Hollow Knight">
                <option value="Knight">Knight</option>
            </optgroup>
            <optgroup label="Silksong">
                <option value="Hornet">Hornet</option>
            </optgroup>
        </select>
    </div>

    <div id="progress-container">
        <div id="progressbar"></div>
        <img src="knight.webp" alt="Knight" id="char-img">
    </div>

    <div id="content">
        <button id="playbutton">PLAY</button>
        <button id="exitbutton">EXIT</button>
    </div>

    <script>

        // Main Loading Interval 3 seconds
        const main_interval = 3000;
        // Fade interval;
        const fade_interval = 500;
        // Delayed main_interval
        const delayed_interval = main_interval + 1000

        // Instantiate the select menu from jquery ui earlier
        $('#select-char').selectmenu()

        // CLICKING PLAY BUTTON
        $('#playbutton').on('click', function () {

            // Hide Play Button
            $('#playbutton').fadeOut(main_interval, () => {
                // Show Exit Button
                // After title fading out is finished execute the following
                $("#title").fadeOut(fade_interval, () => {
                    $('#exitbutton').fadeIn(fade_interval);
                    $("#choose-title").fadeIn(fade_interval)
                    // After fade in of select select menu of jquery
                    $("#select-char-button").fadeIn(fade_interval, () => { })
                    $("#char-img").fadeIn(fade_interval)
                });
            });

            // PROGRESS BAR

            LoadingBar(3000, true);

            // BACKGROUND

            // Fade out current background
            $('#background').css('opacity', 0);

            setTimeout(function () {
                // Change image
                $('#background').css('background-image', 'url("HK2.webp")');
                // Fade it back in
                $('#background').css('opacity', 1);
            }, main_interval); // match the transition duration

        });

        // CLICKING EXIT BUTTON
        $('#exitbutton').on('click', function () {
            // Hide Exit Button
            $(this).fadeOut(fade_interval, () => {
                // Show Play Button
                $("#choose-title").fadeOut(main_interval, () => {
                    $('#playbutton').fadeIn(main_interval);
                    $("#title").fadeIn(fade_interval);
                })
                $("#select-char-button").fadeOut(fade_interval)
                $("#char-img").fadeOut(fade_interval, () => {
                    // PROGRESS BAR
                    LoadingBar(3000, true);


                })
            });

            // BACKGROUND

            // Fade out current background
            $('#background').css('opacity', 0);

            setTimeout(function () {
                // Change image
                $('#background').css('background-image', 'url("HK1.webp")');
                // Fade it back in
                $('#background').css('opacity', 1);
            }, main_interval); // match the transition duration
        });

        // Loading bar is overloaded

        function LoadingBar(millisec, determinate) {
            // PROGRESS BAR

            let ms_per_percent = millisec / 100

            $("#progressbar").fadeIn(fade_interval);

            if (determinate) {
                $("#progressbar").progressbar({
                    value: 0
                });

                var progress = 0;
                var interval = setInterval(function () {
                    progress += 1;
                    $("#progressbar").progressbar("value", progress);
                    if (progress >= 100) {
                        $("#progressbar").fadeOut(fade_interval);
                        clearInterval(interval);
                    }
                }, ms_per_percent);
            } else {
                $("#progressbar").progressbar({
                    value: false
                });

                var interval = setInterval(function () {
                    $("#progressbar").fadeOut(millisec);
                    clearInterval(interval);
                }, ms_per_percent);
            }
        }

        function LoadingBar(millisec, determinate, funky) {
            // PROGRESS BAR

            let ms_per_percent = millisec / 100

            $("#progressbar").fadeIn(fade_interval);

            if (determinate) {
                $("#progressbar").progressbar({
                    value: 0
                });

                var progress = 0;
                var interval = setInterval(function () {
                    progress += 1;
                    $("#progressbar").progressbar("value", progress);
                    if (progress >= 100) {
                        $("#progressbar").fadeOut(fade_interval);
                        clearInterval(interval);
                    }
                }, ms_per_percent);
            } else {
                $("#progressbar").progressbar({
                    value: false
                });

                var interval = setInterval(function () {
                    $("#progressbar").fadeOut(millisec, funky);
                    clearInterval(interval);
                }, ms_per_percent);
            }
        }

        $("#select-char").on("selectmenuselect", function (event, ui) {
            $("#char-img").fadeOut(fade_interval, () => {

                // Store some code in a function
                let funky = function () {
                    // KNIGHT
                    if (ui.item.value == "Knight") {
                        // Fade Out first
                        $("#char-img").attr("src", "knight.webp")
                        $("#char-img").fadeIn(fade_interval)
                    } else {
                        // HORNET
                        $("#char-img").attr("src", "hornet.webp")
                        $("#char-img").fadeIn(fade_interval)
                    }
                }

                // Loading bar
                // Pass the function here
                LoadingBar(3000, false, funky)

            });
        });


    </script>
</body>

</html>